# ğŸ“ 2024.08.14 íšŒê³  ğŸ“
#### 1. ìˆ˜ì—… ë‚´ìš© ë³µìŠµì •ë¦¬

----------
------------

## 13ì¼ ë‚´ìš©ì— ì´ì–´ì„œ ê¸°ëŠ¥ êµ¬í˜„

### 1. í”„ë¡œí•„ ì¡°íšŒ ë° ìˆ˜ì • ê¸°ëŠ¥
- **ì‚¬ìš© í´ë˜ìŠ¤**: `generics.RetrieveUpdateAPIView`
  - í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œí•„ì˜ **ì½ê¸°**ì™€ **ìˆ˜ì •** ê¸°ëŠ¥ì„ êµ¬

## ìš”êµ¬ë˜ëŠ” ê¶Œí•œ ì„¤ì •

### 1. í”„ë¡œí•„ ì¡°íšŒ (ì½ê¸°)
- **ìš”êµ¬ ê¶Œí•œ**: ëª¨ë“  ì‚¬ìš©ì (ì¸ì¦ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥)
- `AllowAny` ê¶Œí•œ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

### 2. í”„ë¡œí•„ ìˆ˜ì •
- **ìš”êµ¬ ê¶Œí•œ**: í•´ë‹¹ í”„ë¡œí•„ì˜ ì†Œìœ ìë§Œ ìˆ˜ì • ê°€ëŠ¥
  - `permission_classes` í•„ë“œë¥¼ ì„¤ì •í•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
  - ì‚¬ìš©ìê°€ í”„ë¡œí•„ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸í•˜ëŠ” ê¶Œí•œ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‘ì„±í•˜ê±°ë‚˜, DRFì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê¶Œí•œ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## API ë³„ ê¶Œí•œ ì„¤ì •

- **ê¶Œí•œì´ ë¯¸ë¦¬ ì¡°í•©ëœ í´ë˜ìŠ¤ í™œìš©**:
  - DRFëŠ” ì—¬ëŸ¬ ê¶Œí•œì„ ì¡°í•©í•œ í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ë¯€ë¡œ, ì´ë¥¼ í™œìš©í•˜ì—¬ API ë³„ë¡œ í•„ìš”í•œ ê¶Œí•œì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

- **ì§ì ‘ ê¶Œí•œ í´ë˜ìŠ¤ ì‘ì„±**:
  - í•„ìš”ì— ë”°ë¼ ì§ì ‘ ê¶Œí•œ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ì—¬ íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤.

## Django Rest Frameworkì—ì„œ ì œê³µí•˜ëŠ” ê¶Œí•œ í´ë˜ìŠ¤ ì˜ˆì‹œ

- `AllowAny`: ëª¨ë“  ìš”ì²­ì„ í†µê³¼ì‹œí‚´. ì¸ì¦ì´ ë¶ˆí•„ìš”í•˜ë©°, ëª¨ë“  ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- `IsAuthenticated`: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìš”ì²­ì„ í†µê³¼ì‹œí‚´. ì„ ì–¸ëœ ì¸ì¦ ë°©ë²•ì„ í†µí•´ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- `IsAdminUser`: ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ ìš”ì²­ì„ í†µê³¼ì‹œí‚´. ê´€ë¦¬ìë¡œ ì„¤ì •ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.


## Django Admin í˜ì´ì§€ì— Userì™€ Profile ëª¨ë¸ í•¨ê»˜ ë“±ë¡í•˜ê¸°

Django ê´€ë¦¬ì(Admin) í˜ì´ì§€ì—ì„œ `User` ëª¨ë¸ë§Œ ë“±ë¡í•˜ë©´ `Profile` ëª¨ë¸ì´ ë‚˜íƒ€ë‚˜ì§€ ì•Šì•„ ë¶ˆí¸í•¨ì´ ìˆë‹¤.
í•˜ì§€ë§Œ, `User` ëª¨ë¸ê³¼ `Profile` ëª¨ë¸ì„ í•¨ê»˜ ë“±ë¡í•˜ì—¬ ë™ì¼í•œ ëª¨ë¸ì¸ ê²ƒì²˜ëŸ¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤.

## ê²Œì‹œê¸€ ê¸°ëŠ¥ ì •ë¦¬

- ê²Œì‹œê¸€ ìƒì„±
- ê²Œì‹œê¸€ 1ê°œ ê°€ì ¸ì˜¤ê¸°
- ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°(ê°€ì ¸ì˜¤ëŠ” ê°œìˆ˜ ì œí•œí•˜ê¸°)
- ê²Œì‹œê¸€ ìˆ˜ì •í•˜ê¸°
- ê²Œì‹œê¸€ ì‚­ì œí•˜ê¸°
- ê²Œì‹œê¸€ ì¢‹ì•„ìš” ê¸°ëŠ¥
- ê²Œì‹œê¸€ í•„í„°ë§(ì¢‹ì•„ìš” ëˆ„ë¥¸ ê¸€/ë‚´ê°€ ì‘ì„±í•œ ê¸€)
- ê²Œì‹œê¸€ ê° ê¸°ëŠ¥ë§ˆë‹¤ ê¶Œí•œ ì„¤ì •

#### ëª¨ë¸ì˜ í•„ë“œ êµ¬ì„±
- ì €ì
- ì €ì í”„ë¡œí•„
- ì œëª©
- ì¹´í…Œê³ ë¦¬
- ë³¸ë¬¸
- ì´ë¯¸ì§€ â†’ ì´ë¯¸ì§€ê°€ ì—†ì„ ë•ŒëŠ” `default.png` íŒŒì¼ í‘œì‹œ
- ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒë“¤ â†’ ë‹¤ëŒ€ë‹¤(ManyToMany)
- ê¸€ì´ ì˜¬ë¼ê°„ ì‹œê°„

#### ê²Œì‹œê¸€ ê¸°ëŠ¥

##### PostSerializer()
- ê²Œì‹œê¸€ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ë‹¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰
- profile í•„ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šìœ¼ë©´ `profile` í•„ë“œì—ëŠ”`profile`ì˜ `PK` ê°’ë§Œ ë‚˜íƒ€ë‚˜ë¯€ë¡œ `ProfileSerializer`ë¥¼ í¬í•¨í•˜ë„ë¡ í•˜ë©°, `Nested Serializer`ë¼ê³  í•¨

##### PostCreateSerializer()
- ê²Œì‹œë¬¼ì„ ë“±ë¡í•  ë•Œ ìœ ì €ëŠ” ì œëª©, ì¹´í…Œê³ ë¦¬, ë³¸ë¬¸, ì´ë¯¸ì§€ ë“±ë§Œ ì…ë ¥í•¨
- ë‚˜ë¨¸ì§€ëŠ” ì‹œìŠ¤í…œì´ ì•Œì•„ì„œ ì±„ì›Œì£¼ê±°ë‚˜ ë¹ˆì¹¸ìœ¼ë¡œ ë‚¨ê²¨ë‘ 
- ì‹œë¦¬ì–¼ë¼ì´ì €ëŠ” ìœ ì €ê°€ ì…ë ¥í•œ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  Django ë°ì´í„°ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥í•˜ê²Œ í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰

### Views(CRUD) + ê¶Œí•œ
- ê²Œì‹œê¸€ì€ ëª¨ë“  `CRUD` ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ `ViewSet`ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ ì ìš© ê°€ëŠ¥í•¨
- ë‹¨, ê°ê¸° ë‹¤ë¥¸ ì‹œë¦¬ì–¼ë¼ì´ì €ë¥¼ ì ì¬ì ì†Œì— í™œìš©í•˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•¨
- ê²Œì‹œê¸€ ìƒì„± ì‹œ ìœ ì €ê°€ ì…ë ¥í•´ ì£¼ì§€ ì•ŠëŠ” ì €ì ì •ë³´ë¥¼ ê°™ì´ ë„£ì„ ìˆ˜ ìˆë„ë¡ í•¨

- ìš”êµ¬ë˜ëŠ” ê¶Œí•œ
  - ê²Œì‹œê¸€ì˜ ì¡°íšŒ: ëª¨ë“  ì‚¬ëŒ
  - ê²Œì‹œê¸€ì˜ ìƒì„±: ì¸ì¦ëœ ìœ ì €ë§Œ ê°€ëŠ¥
  - ê²Œì‹œê¸€ì˜ ìˆ˜ì •/ì‚­ì œ: í•´ë‹¹ ê¸€ì˜ ì‘ì„±ìë§Œ ê°€ëŠ¥
- Userì—ì„œì˜ `CustomReadOnly`ì™€ ë‹¤ë¥¸ ì 
  - ê° ê°ì²´ë³„ ê¶Œí•œ ë¿ë§Œ ì•„ë‹ˆë¼ ì „ì²´ ê°ì²´ì— ëŒ€í•œ ê¶Œí•œë„ í¬í•¨í•´ì•¼ í•¨(ëª©ë¡ ì¡°íšŒ/ìƒì„±)
    - `has_permission()`ì„ í•¨ê»˜ êµ¬í˜„

1. ì‚¬ìš©ì(User) ê´€ë ¨ ê¸°ëŠ¥
1.1 í”„ë¡œí•„ ì¡°íšŒ ë° ìˆ˜ì •
í”„ë¡œí•„ ì¡°íšŒ: ëª¨ë“  ì‚¬ìš©ìê°€ í”„ë¡œí•„ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í”„ë¡œí•„ ìˆ˜ì •: í”„ë¡œí•„ ì†Œìœ ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### users/views.py
```
from .serializers import RegisterSerializer, LoginSerializer, ProfileSerializer
from .models import Profile
from rest_framework import generics
from .permissions import CustomReadOnly

class ProfileView(generics.RetrieveUpdateAPIView):
    queryset = Profile.objects.all()
    serializer_class = ProfileSerializer
    permission_classes = [CustomReadOnly]
```

#### users/permissions.py
```
from rest_framework import permissions

class CustomReadOnly(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        if request.method in permissions.SAFE_METHODS:
            return True
        return obj.user == request.user
```

#### users/urls.py
```
from django.urls import path
from .views import RegisterView, LoginView, ProfileView

urlpatterns = [
    path('register/', RegisterView.as_view()),
    path('login/', LoginView.as_view()),
    path('profile/<int:pk>/', ProfileView.as_view()),
]
```

## 1.2 ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ Userì™€ Profile ë™ì‹œ ê´€ë¦¬

##### users/admin.py
```
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from django.contrib.auth.models import User
from .models import Profile

class ProfileInline(admin.StackedInline):
    model = Profile
    can_delete = False
    verbose_name_plural = 'profile'

class UserAdmin(BaseUserAdmin):
    inlines = (ProfileInline, )

admin.site.unregister(User)
admin.site.register(User, UserAdmin)
```

## 2. ê²Œì‹œê¸€(Post) ê´€ë ¨ ê¸°ëŠ¥
- 2.1 ê²Œì‹œê¸€ ëª¨ë¸ ìƒì„±

#### posts/models.py
```
from django.db import models
from django.contrib.auth.models import User
from django.utils import timezone
from users.models import Profile

class Post(models.Model):
    author = models.ForeignKey(User, on_delete=models.CASCADE, related_name='posts')
    profile = models.ForeignKey(Profile, on_delete=models.CASCADE, blank=True)
    title = models.CharField(max_length=128)
    category = models.CharField(max_length=128)
    body = models.TextField()
    image = models.ImageField(upload_to='post/', default='default.png')
    likes = models.ManyToManyField(User, related_name='like_posts', blank=True)
    published_date = models.DateTimeField(default=timezone.now)
ì£¼ì˜: authorì™€ likes í•„ë“œ ëª¨ë‘ User ëª¨ë¸ì„ ì°¸ì¡°í•˜ë¯€ë¡œ related_nameì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.
```

## 2.2 ì‹œë¦¬ì–¼ë¼ì´ì €(Serializers)

#### posts/serializers.py
```
from rest_framework import serializers
from users.serializers import ProfileSerializer
from .models import Post

class PostSerializer(serializers.ModelSerializer):
    profile = ProfileSerializer(read_only=True)

    class Meta:
        model = Post
        fields = ("pk", "profile", "title", "body", "image", "published_date", "likes")

class PostCreateSerializer(serializers.ModelSerializer):
    class Meta:
        model = Post
        fields = ("title", "category", "body", "image")
```

## 2.3 ê¶Œí•œ ì„¤ì •

#### posts/permissions.py
```
from rest_framework import permissions

class CustomReadOnly(permissions.BasePermission):
    def has_permission(self, request, view):
        if request.method == 'GET':
            return True
        return request.user.is_authenticated

    def has_object_permission(self, request, view, obj):
        if request.method in permissions.SAFE_METHODS:
            return True
        return obj.author == request.user
```

## 2.4 ë·°(View) ì„¤ì •

#### posts/views.py
```
from rest_framework import viewsets
from .models import Post
from .serializers import PostSerializer, PostCreateSerializer
from .permissions import CustomReadOnly

class PostViewSet(viewsets.ModelViewSet):
    queryset = Post.objects.all()
    permission_classes = [CustomReadOnly]

    def get_serializer_class(self):
        if self.action == 'create':
            return PostCreateSerializer
        return PostSerializer

    def perform_create(self, serializer):
        serializer.save(author=self.request.user, profile=self.request.user.profile)
```
## 2.5 URL ì„¤ì •

#### posts/urls.py
```
from rest_framework import routers
from .views import PostViewSet

router = routers.SimpleRouter()
router.register('posts', PostViewSet)

urlpatterns = router.urls
```
## 3. í”„ë¡œì íŠ¸ ì„¤ì •
### 3.1 ì•± ë“±ë¡

#### board/settings.py
```
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'rest_framework.authtoken',
    'users',
    'corsheaders',
    'posts',
]
```
## 3.2 ë£¨íŠ¸ URL ì„¤ì •

#### board/urls.py
```
from django.urls import path, include
from django.contrib import admin
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('users/', include('users.urls')),
    path('', include('posts.urls')),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```
## 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ì„œë²„ ì‹¤í–‰

#### ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
```
python manage.py makemigrations
```
#### ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
```
python manage.py migrate
```
#### ì„œë²„ ì‹¤í–‰
```
python manage.py runserver
```
