# ğŸ“ 2024.09.27 íšŒê³  ğŸ“
#### 1. ìˆ˜ì—… ë‚´ìš© ë³µìŠµì •ë¦¬
#### 2. ë°±ì¤€

---------------------------------


## S3ì‚¬ìš©í•˜ê¸°
- ì–´ì œ ì½”ë“œì—ì„œ ë§¨ ì•„ë˜ ì•”í˜¸í‚¤ ì¶”ê°€ë¥¼ í•˜ê²Œ ë˜ë©´ ë¡œì»¬ì‚¬ìš©ì´ ê°€ëŠ¥í•œê²ƒê°™ë‹¤(ë‚˜ëŠ” ì„±ê³µí•˜ì§€ ëª»í•¨..)
```
import io
import os
import uuid

import boto3
from boto3.s3.transfer import S3UploadFailedError
from botocore.exceptions import ClientError


def do_scenario(s3_resource):
    print("-" * 88)
    print("Welcome to the Amazon S3 getting started demo!")
    print("-" * 88)

    bucket_name = f"doc-example-bucket-{uuid.uuid4()}"
    bucket = s3_resource.Bucket(bucket_name)
    try:
        bucket.create(
            CreateBucketConfiguration={
                "LocationConstraint": s3_resource.meta.client.meta.region_name
            }
        )
        print(f"Created demo bucket named {bucket.name}.")
    except ClientError as err:
        print(f"Tried and failed to create demo bucket {bucket_name}.")
        print(f"\t{err.response['Error']['Code']}:{err.response['Error']['Message']}")
        print(f"\nCan't continue the demo without a bucket!")
        return

    file_name = None
    while file_name is None:
        file_name = input("\nEnter a file you want to upload to your bucket: ")
        if not os.path.exists(file_name):
            print(f"Couldn't find file {file_name}. Are you sure it exists?")
            file_name = None

    obj = bucket.Object(os.path.basename(file_name))
    try:
        obj.upload_file(file_name)
        print(
            f"Uploaded file {file_name} into bucket {bucket.name} with key {obj.key}."
        )
    except S3UploadFailedError as err:
        print(f"Couldn't upload file {file_name} to {bucket.name}.")
        print(f"\t{err}")

    answer = input(f"\nDo you want to download {obj.key} into memory (y/n)? ")
    if answer.lower() == "y":
        data = io.BytesIO()
        try:
            obj.download_fileobj(data)
            data.seek(0)
            print(f"Got your object. Here are the first 20 bytes:\n")
            print(f"\t{data.read(20)}")
        except ClientError as err:
            print(f"Couldn't download {obj.key}.")
            print(
                f"\t{err.response['Error']['Code']}:{err.response['Error']['Message']}"
            )

    answer = input(
        f"\nDo you want to copy {obj.key} to a subfolder in your bucket (y/n)? "
    )
    if answer.lower() == "y":
        dest_obj = bucket.Object(f"demo-folder/{obj.key}")
        try:
            dest_obj.copy({"Bucket": bucket.name, "Key": obj.key})
            print(f"Copied {obj.key} to {dest_obj.key}.")
        except ClientError as err:
            print(f"Couldn't copy {obj.key} to {dest_obj.key}.")
            print(
                f"\t{err.response['Error']['Code']}:{err.response['Error']['Message']}"
            )

    print("\nYour bucket contains the following objects:")
    try:
        for o in bucket.objects.all():
            print(f"\t{o.key}")
    except ClientError as err:
        print(f"Couldn't list the objects in bucket {bucket.name}.")
        print(f"\t{err.response['Error']['Code']}:{err.response['Error']['Message']}")

    answer = input(
        "\nDo you want to delete all of the objects as well as the bucket (y/n)? "
    )
    if answer.lower() == "y":
        try:
            bucket.objects.delete()
            bucket.delete()
            print(f"Emptied and deleted bucket {bucket.name}.\n")
        except ClientError as err:
            print(f"Couldn't empty and delete bucket {bucket.name}.")
            print(
                f"\t{err.response['Error']['Code']}:{err.response['Error']['Message']}"
            )

    print("Thanks for watching!")
    print("-" * 88)


# if __name__ == "__main__":
#     do_scenario(boto3.resource("s3"))

if __name__ == "__main__":

    session = boto3.Session(
        aws_access_key_id = "**********",
        aws_secret_access_key = "*****************************************",
        region_name = "ap-northeast-2"
    )
    do_scenario(session.resource('s3'))
```
- ì•”í˜¸í‚¤ë‘ ë¦¬ì „ë„¤ì„(ì„œìš¸)ì„ ë„£ì–´ì£¼ë‹ˆê¹Œ ë™ì‘ë˜ëŠ” ê²ƒì„ í™•ì¸
![Uploading image.pngâ€¦]()

## DynamoDB ì‚¬ìš©
- https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/programming-with-python.html
- í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í•­ëª© ì‚½ì…í•˜ê¸°

```
- dynamodbì—ì„œ í…Œì´ë¸”ì„ ìƒì„±í•´ì„œ ì§„í–‰(test ë¼ëŠ” í…Œì´ë¸”)


import boto3

dynamodb = boto3.client('dynamodb')

dynamodb.put_item(
    TableName='YourTableName', # ìš°ë¦¬ì˜ ê²½ìš° test
    Item={
        'pk': {'S': 'id#1'},
        'sk': {'S': 'cart#123'},
        'name': {'S': 'SomeName'},
        'inventory': {'N': '500'},
        # ... more attributes ...
    }
)
```
![image](https://github.com/user-attachments/assets/f199b04a-58c4-4fa9-a851-fb9629948506)
![image](https://github.com/user-attachments/assets/9a80e6c0-8579-47f3-8e9c-48c6d0542cc3)
------------
- ë¦¬ì†ŒìŠ¤ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í•­ëª© ì‚½ì…í•˜ê¸°
```
- ì´ë²ˆì—ëŠ” ubuntuì—ì„œ nanoë¥¼ ì‚¬ìš©í•´ì„œ ì—ë””í„°ë¥¼ ëŒ€ì‹ í•¨
- ì´ë²ˆì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì•„ë‹Œ í…Œì´ë¸” ë¦¬ì†ŒìŠ¤ì—ì„œ ê°€ì ¸ì™€ ê·¸ ì•ˆì— ì§‘ì–´ ë„£ëŠ” ê²ƒìœ¼ë¡œ ì§„í–‰í•¨
import boto3

dynamodb = boto3.resource('dynamodb')

table = dynamodb.Table('YourTableName') # ìš°ë¦¬ì˜ ê²½ìš° test

table.put_item(
    Item={
        'pk': 'id#1',
        'sk': 'cart#123',
        'name': 'SomeName',
        'inventory': 500,
        # ... more attributes ...
    }
)
```
![image](https://github.com/user-attachments/assets/5ad9c396-51e3-4b3d-af65-53c58c5ef3fa)
- nanoì˜ ê²½ìš° ctrl 5ë¥¼ ëˆŒëŸ¬ì•¼ ì €ì¥ì´ ë¨
![image](https://github.com/user-attachments/assets/8cfbfe9e-d888-4406-9c7b-7c36fddd10df)
- ìœ„ì™€ê°™ì´ ì €ì¥ëœê²ƒì„ í™•ì¸
-------------
- í•¨ê»˜ ì œê³µëœ ë° í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ë°˜ JSONê³¼ DynamoDB JSON ê°„ì— ë³€í™˜í•˜ê¸°
```
def dynamo_to_python(dynamo_object: dict) -> dict:
    deserializer = TypeDeserializer()
    return {
        k: deserializer.deserialize(v)
        for k, v in dynamo_object.items()
    }

def python_to_dynamo(python_object: dict) -> dict:
    serializer = TypeSerializer()
    return {
        k: serializer.serialize(v)
        for k, v in python_object.items()
    }
```
-----------
- í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ ìˆ˜í–‰í•˜ê¸°
```
import boto3

client = boto3.client('dynamodb')

# Construct the query
response = client.query(
    TableName='YourTableName',
    KeyConditionExpression='pk = :pk_val AND begins_with(sk, :sk_val)',
    FilterExpression='#name = :name_val',
    ExpressionAttributeValues={
        ':pk_val': {'S': 'id#1'},
        ':sk_val': {'S': 'cart#'},
        ':name_val': {'S': 'SomeName'},
    },
    ExpressionAttributeNames={
        '#name': 'name',
    }
)
```
- ìœ„ ë‚´ìš©ë„ ë™ì¼í•˜ê²Œ nanoë¡œ ì§„í–‰
![image](https://github.com/user-attachments/assets/96346873-ff85-4460-82cb-52f78f854f5c)
![image](https://github.com/user-attachments/assets/6da75ffa-69d6-4137-93e1-d4d9c2fdab32)
-------
- ë¦¬ì†ŒìŠ¤ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ ìˆ˜í–‰í•˜ê¸°
```
import boto3
from boto3.dynamodb.conditions import Key, Attr

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('YourTableName')

response = table.query(
    KeyConditionExpression=Key('pk').eq('id#1') & Key('sk').begins_with('cart#'),
    FilterExpression=Attr('name').eq('SomeName')
)
```
![image](https://github.com/user-attachments/assets/5d539d0f-1d43-4970-94c4-4eb80c82c8dd)
- ìœ„ ë‹¤ë¥¸ê²ƒë“¤ì´ë‘ í˜•íƒœê°€ ì¡°ê¸ˆ ë‹¤ë¥¸ê²ƒì„ í™•ì¸í•¨
------------
- í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ì˜ ëŒ€ëµì ì¸ í¬ê¸° ì–»ê¸°
```
import boto3

dynamodb = boto3.client('dynamodb')

response = dynamodb.describe_table(TableName='YourTableName')
size = response['Table']['TableSizeBytes']

print(f"Table size: {size}")
```
![image](https://github.com/user-attachments/assets/731712da-1a02-47b7-9932-855d5c6d73a2)
--------

- ë¦¬ì†ŒìŠ¤ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ì˜ ëŒ€ëµì ì¸ í¬ê¸° ì–»ê¸°
```
import boto3

dynamodb = boto3.resource('dynamodb')

table = dynamodb.Table('YourTableName')
size = table.table_size_bytes

print(f"Table size: {size}")
```
![image](https://github.com/user-attachments/assets/825bdd9c-4cd4-4b54-89a8-eb21771489e6)
![image](https://github.com/user-attachments/assets/04aeb72a-505f-434a-9fe1-bf1ab4ffa644)

-----------

### Polly ì‚¬ìš©í•˜ê¸°
- https://docs.aws.amazon.com/ko_kr/polly/latest/dg/get-started-what-next.html
```
from boto3 import Session
from botocore.exceptions import BotoCoreError, ClientError
from contextlib import closing
import os
import sys
import subprocess
from tempfile import gettempdir

# AWS ìê²© ì¦ëª… íŒŒì¼ (~/.aws/credentials)ì˜ [ê´€ë¦¬ì] ì„¹ì…˜ì— ì •ì˜ ëœ
# ìê²© ì¦ëª… ë° ì˜ì—­ì„ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¥¼ ë§Œë“¦(~/.aws/credentials).
session = Session(profile_name="adminuser")
polly = session.client("polly")

try:
    # ìŒì„± í•©ì„± ìš”ì²­
    response = polly.synthesize_speech(Text="Hello world!", OutputFormat="mp3", VoiceId="Joanna")

except (BotoCoreError, ClientError) as error:
    # ì„œë¹„ìŠ¤ëŠ” ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•˜ê³  ì¢…ë£Œ
    print(error)
    sys.exit(-1)

# ì‘ë‹µìœ¼ë¡œë¶€í„° ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ì•¡ì„¸ìŠ¤
if "AudioStream" in response:
    # ì°¸ê³  : ì„œë¹„ìŠ¤ê°€ ë³‘ë ¬ ì—°ê²° ìˆ˜ì— ì¡°ì ˆë˜ê¸° ë•Œë¬¸ì— ìŠ¤íŠ¸ë¦¼ì„ ë‹«ëŠ” ê²ƒì´ ì¤‘ìš”í•¨.
    # ì—¬ê¸°ì„œëŠ” contextLib.closingì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ ê°ì²´ì˜ ë‹«ê¸° ë©”ì†Œë“œê°€ ëª…ë ¹ë¬¸ì˜
    # ë²”ìœ„ ëì— ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ë„ë¡ í•¨.
    with closing(response["AudioStream"]) as stream:
        output = os.path.join(gettempdir(), "speech.mp3")

        try:
        # ë°”ì´ë„ˆë¦¬ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì¶œë ¥ì„ ì“°ê¸°ìœ„í•œ íŒŒì¼ ì—´ê¸°
            with open(output, "wb") as file:
                file.write(stream.read())
        except IOError as error:
            # íŒŒì¼ì— ì“¸ ìˆ˜ ì—†ì—ˆìŒ. ì¢…ë£Œ
            print(error)
            sys.exit(-1)

else:
    # ì‘ë‹µì— ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šì•˜ìŒ. ì¢…ë£Œ
    print("Could not stream audio")
    sys.exit(-1)

# í”Œë«í¼ì˜ ê¸°ë³¸ í”Œë ˆì´ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤ë””ì˜¤ ì¬ìƒ
# ìœˆë„ìš°ì˜ ê²½ìš°
if sys.platform == "win32":
    os.startfile(output)
else:
    # MacOS ë° Linuxì˜ ê²½ìš°(Darwin = Mac, XDG-OPEN = Linux)
    opener = "open" if sys.platform == "darwin" else "xdg-open"
    subprocess.call([opener, output])
```
- ë¦¬ëˆ…ìŠ¤ ìª½ì—ì„œëŠ” ì¬ìƒì€ ì•ˆë˜ì§€ë§Œ íŒŒì¼ì€ ìƒì„±ë¨
- ê¶Œí•œì„ ë§Œë“¤ì–´ì„œ ì§„í–‰í•˜ëŠ”ê²ƒì´ ì¢‹ì•„ë³´ì„

## í´ë¼ìš°ë“œ ì„œë²„ ë‚´ Docker & Kubernates 





```
```

```
```

```
```
