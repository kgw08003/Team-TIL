# ğŸ“ 2024.08.20 íšŒê³  ğŸ“
#### 1. ìˆ˜ì—… ë‚´ìš© ë³µìŠµì •ë¦¬


# Pystagram í”„ë¡œì íŠ¸ ìš”ì•½ ë° ì½”ë“œ ì„¤ëª…

## 1. User ìƒì„± ë° Signup View êµ¬í˜„

### 1.1 Terminalì—ì„œ User ìƒì„± í™•ì¸
```
# User ëª¨ë¸ì—ì„œ íŠ¹ì • ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
from users.models import User

# ì‚¬ìš©ìëª…ì´ "pystagram"ì¸ Userê°€ ìˆëŠ”ì§€ í™•ì¸
User.objects.filter(username="pystagram")
User.objects.filter(username="pystagram").exists()

# ì‚¬ìš©ìëª…ì´ "no_user"ì¸ Userê°€ ìˆëŠ”ì§€ í™•ì¸
User.objects.filter(username="no_user")
User.objects.filter(username="no_user").exists()
```

## 1.2 Signup View êµ¬í˜„
### 1.2.1 ê¸°ë³¸ Signup View
```
# views.pyì—ì„œ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ëŠ” signup í•¨ìˆ˜ë¥¼ ì •ì˜
from users.models import User

def signup(request):
    if request.method == "POST":
        form = SignupForm(data=request.POST, files=request.FILES)
        if form.is_valid():
            username = form.cleaned_data["username"]
            password1 = form.cleaned_data["password1"]
            password2 = form.cleaned_data["password2"]
            profile_image = form.cleaned_data["profile_image"]
            short_description = form.cleaned_data["short_description"]

            if password1 != password2:
                form.add_error("password2", "ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ë€ì˜ ê°’ì´ ë‹¤ë¦…ë‹ˆë‹¤.")

            if User.objects.filter(username=username).exists():
                form.add_error("username", "ì…ë ¥í•œ ì‚¬ìš©ìëª…ì€ ì´ë¯¸ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.")

            if form.errors:
                context = {"form": form}
                return render(request, "users/signup.html", context)
            else:
                user = User.objects.create_user(
                    username=username,
                    password=password1,
                    profile_image=profile_image,
                    short_description=short_description,
                )
                login(request, user)
                return redirect("/posts/feeds/")
    else:
        form = SignupForm()
        context = {"form": form}
        return render(request, "users/signup.html", context)
```
### 1.2.2 SignupForm ë‚´ë¶€ì—ì„œ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
- users/forms.py

```
# clean_username ë©”ì„œë“œë¥¼ í†µí•´ ì‚¬ìš©ìëª… ìœ íš¨ì„±ì„ ê²€ì¦
from django import forms
from django.core.exceptions import ValidationError
from users.models import User

class SignupForm(forms.Form):
    ...

    def clean_username(self):
        username = self.cleaned_data["username"]
        if User.objects.filter(username=username).exists():
            raise ValidationError(f"ì…ë ¥í•œ ì‚¬ìš©ìëª…({username})ì€ ì´ë¯¸ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤")
        return username
```
```
# clean ë©”ì„œë“œë¥¼ í†µí•´ ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ë¥¼ ê²€ì¦
class SignupForm(forms.Form):
    ...

    def clean(self):
        password1 = self.cleaned_data["password1"]
        password2 = self.cleaned_data["password2"]
        if password1 != password2:
            self.add_error("password2", "ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ë€ì˜ ê°’ì´ ë‹¤ë¦…ë‹ˆë‹¤")
```
### 1.3 SignupFormê³¼ View í•¨ìˆ˜ ë¦¬íŒ©í† ë§
```
# SignupFormì— ì‚¬ìš©ì ìƒì„± ë¡œì§ì„ ì¶”ê°€
class SignupForm(forms.Form):
    def clean(self):
        ...

    def save(self):
        username = self.cleaned_data["username"]
        password1 = self.cleaned_data["password1"]
        profile_image = self.cleaned_data["profile_image"]
        short_description = self.cleaned_data["short_description"]
        user = User.objects.create_user(
            username=username,
            password=password1,
            profile_image=profile_image,
            short_description=short_description,
        )
        return user
```
```
# signup viewì—ì„œ save() ë©”ì„œë“œë¥¼ í™œìš©í•´ ë¦¬íŒ©í† ë§
def signup(request):
    if request.method == "POST":
        form = SignupForm(data=request.POST, files=request.FILES)

        if form.is_valid():
            user = form.save()
            login(request, user)
            return redirect("/posts/feeds/")

        context = {"form": form}
        return render(request, "users/signup.html", context)
    
    form = SignupForm()
    context = {"form": form}
    return render(request, "users/signup.html", context)
```
# 2. í”¼ë“œ í˜ì´ì§€ êµ¬í˜„
## 2.1 ê¸€/ì´ë¯¸ì§€/ëŒ“ê¸€ ëª¨ë¸ë§
### 2.1.1 Model êµ¬ì„±
- posts/models.py

```
from django.db import models

class Post(models.Model):
    user = models.ForeignKey("users.User", verbose_name="ì‘ì„±ì", on_delete=models.CASCADE)
    content = models.TextField("ë‚´ìš©")
    created = models.DateTimeField("ìƒì„±ì¼ì‹œ", auto_now_add=True)

class PostImage(models.Model):
    post = models.ForeignKey(Post, verbose_name="í¬ìŠ¤íŠ¸", on_delete=models.CASCADE)
    photo = models.ImageField("ì‚¬ì§„", upload_to="post")

class Comment(models.Model):
    user = models.ForeignKey("users.User", verbose_name="ì‘ì„±ì", on_delete=models.CASCADE)
    post = models.ForeignKey(Post, verbose_name="í¬ìŠ¤íŠ¸", on_delete=models.CASCADE)
    content = models.TextField("ë‚´ìš©")
    created = models.DateTimeField("ìƒì„±ì¼ì‹œ", auto_now_add=True)
```
### 2.1.2 admin êµ¬í˜„
- posts/admin.py
  
```
from django.contrib import admin
from posts.models import Post, PostImage, Comment

@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ["id", "content"]

@admin.register(PostImage)
class PostImageAdmin(admin.ModelAdmin):
    list_display = ["id", "post", "photo"]

@admin.register(Comment)
class CommentAdmin(admin.ModelAdmin):
    list_display = ["id", "post", "content"]
```
### 2.2 í”¼ë“œ í˜ì´ì§€ View ì‘ì„±
- posts/views.py

```
from posts.models import Post

def feeds(request):
    user = request.user
    if not user.is_authenticated:
        return redirect("/users/login/")

    posts = Post.objects.all()
    context = {"posts": posts}
    return render(request, "posts/feeds.html", context)
```
### 2.3 í”¼ë“œ í˜ì´ì§€ í…œí”Œë¦¿ êµ¬í˜„
- templates/posts/feeds.html
```
{% extends 'base.html' %}

{% block content %}
<nav>
    <h1>Pystagram</h1>
</nav>
<div id="feeds" class="post-container">
    {% for post in posts %}
    <article class="post">
        <header class="post-header">
            {% if post.user.profile_image %}
            <img src="{{ post.user.profile_image.url }}">
            {% endif %}
            <span>{{ post.user.username }}</span>
        </header>

        <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ì˜ì—­ ì‹œì‘ -->
        <div class="post-images splide">
            <div class="splide__track">
                <ul class="splide__list">
                    {% for image in post.postimage_set.all %}
                    {% if image.photo %}
                    <li class="splide__slide">
                        <img src="{{ image.photo.url }}">
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
        <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ì˜ì—­ ì¢…ë£Œ -->

        <div class="post-content">
            {{ post.content|linebreaksbr }}
        </div>
        <div class="post-buttons">
            <button>Likes(0)</button>
            <span>Comments(0)</span>
        </div>
        <div class="post-comments">
            <ul>
                <!-- ê° Postì— ì—°ê²°ëœ PostCommentë“¤ì„ ìˆœíšŒ -->
                {% for comment in post.comment_set.all %}
                <li>
                    <span>{{ comment.user.username }}</span>
                    <span>{{ comment.content }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <small>{{ post.created }}</small>
        <div class="post-comments-create">
            <input type="text" placeholder="ëŒ“ê¸€ ë‹¬ê¸°...">
            <button type="submit">ê²Œì‹œ</button>
        </div>
    </article>
    {% endfor %}
</div>

<script>
    const elms = document.getElementsByClassName('splide')
    for (let i = 0; i < elms.length; i++){
        new Splide(elms[i]).mount();
    }
</script>
{% endblock %}
```
# <ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ë©´ ë‚˜ì˜¤ëŠ” ëª¨ìŠµ>
![image](https://github.com/user-attachments/assets/672ec686-04c1-426f-8296-4d73d800c08d)

##### ì•„ë˜ ëŒ“ê¸€ ë‹¬ê¸°ì— ë“¤ì–´ê°€ëŠ” ê¸°ëŠ¥ì€ ì•„ì§ ì´ˆë°˜ë¶€ë¼ í•™ìŠµí•œê³³ ê¹Œì§€ë§Œ ì •ë¦¬í•¨

# 3. ëŒ“ê¸€ ê¸°ëŠ¥ êµ¬í˜„
## 3.1 ëŒ“ê¸€ ì‘ì„±
### 3.1.1 CommentForm êµ¬í˜„
- posts/forms.py
  
```
from django import forms
from posts.models import Comment

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        fields = ["content"]
```
## 3.1.2 ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜ í•´ê²°
- Terminalì—ì„œ CommentForm í…ŒìŠ¤íŠ¸
```
# CommentFormì„ í…ŒìŠ¤íŠ¸í•˜ì—¬ ì˜¤ë¥˜ë¥¼ í•´ê²° í•˜ê³ ìí•¨.
from posts.forms import CommentForm

data = {"content": "SampleContent"}
form = CommentForm(data=data)
form.is_valid()  # True
comment = form.save(commit=False)

from users.models import User
from posts.models import Post

user = User.objects.all()[0]
post = Post.objects.all()[0]

comment.user = user
comment.post = post
comment.save()
comment.id  # ì €ì¥ëœ ëŒ“ê¸€ì˜ ID í™•ì¸
```
![image](https://github.com/user-attachments/assets/b923c7df-22bd-4ad6-9ad3-bade2118b75c)

##### python manage.py shellì„ ì´ìš©í•´ì„œ testí•˜ëŠ” ì´ìœ ?
- í•´ë‹¹ ë‚´ìš©ì´ ëœ¬ê¸ˆì—†ì´ ê³„ì† ë“±ì¥í•´ì„œ ì´ë¥¼ ì•Œì•„ë³´ì•˜ë”ë‹ˆ, ì½”ë“œì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ì¸í„°ë ‰í‹°ë¸Œí•˜ê²Œ ë””ë²„ê¹…í•  ìˆ˜ ìˆê³ , ì¥ê³  í”„ë¡œì íŠ¸ ì„¤ì •ì´ë‚˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ê±°ë‚˜ í…ŒìŠ¤íŠ¸ë¥¼ í• ë•Œ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤.
- pythonì‰˜ì„ í™•ì¥í•´ì„œ django í”„ë¡œì íŠ¸ì˜ í™˜ê²½ì„ ìë™ìœ¼ë¡œ ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ ê´€ë ¨ ì‘ì—…ì„ ì‹¤ì œë¡œ ì•±ì—ì„œ ì‹¤í–‰í•˜ê¸° ì „ì— ê°„ë‹¨í•˜ê²Œ ì‰˜ì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤(ì´ë¥¼ í†µí•´ ì½”ë“œë¥¼ ë¹ ë¥´ê²Œ ê²€ì¦í•˜ê³  ê°œì„ í•  ìˆ˜ ìˆë‹¤.)
