# ğŸ’ 8ì›” 27ì¼ íšŒê³ 
## ğŸª ì˜¨ë¼ì¸ ìƒì  êµ¬ì¶• í”„ë¡œì íŠ¸ ğŸª
### ğŸ“2-3 ê³ ê° ì£¼ë¬¸ ë“±ë¡í•˜ê¸°
### (1) ì£¼ë¬¸ ëª¨ë¸ ìƒì„±í•˜ê¸°
- orders/models.py

 ```python
  from django.db import models
  from shop.models import Product
  
  class Order(models.Model):
      first_name = models.CharField(max_length=50)
      last_name = models.CharField(max_length=50)
      email = models.EmailField()
      address = models.CharField(max_length=250)
      postal_code = models.CharField(max_length=20)
      city = models.CharField(max_length=100)
      created = models.DateTimeField(auto_now_add=True)
      updated = models.DateTimeField(auto_now=True)
      paid = models.BooleanField(default=False) #ì§€ë¶ˆì—¬ë¶€
  
      class Meta:
          ordering = ['-created'] # -ë¥¼ ë¶™ì´ë©´ ìµœì‹ ë‚´ìš©ë¶€í„° ë‚˜ì˜´
          indexes = [
              models.Index(fields=['-created']),
          ]
  
      def __str__(self):
          return f"Order {self.id}" #Order1ë²ˆ Order2ë²ˆ ì´ëŸ°ì‹ìœ¼ë¡œ ì¶œë ¥ë¨
      
      def get_total_cost(self):
          return sum(item.get_cost() for item in self.items.all())
      
  class OrderItem(models.Model):
      order = models.ForeignKey(Order, related_name='items', on_delete=models.CASCADE)
      product = models.ForeignKey(Product, related_name="order_items", on_delete=models.CASCADE)
      price = models.DecimalField(max_digits=10, decimal_places=2)
      quantity = models.PositiveIntegerField(default=1)
  
      def __str__(self):
          return str(self.id)
  
      def get_cost(self):
          return self.price * self.quantity

 ```

### (2) ê´€ë¦¬ ì‚¬ì´íŠ¸ì— ì£¼ë¬¸ ëª¨ë¸ ì¶”ê°€í•˜ê¸°
- orders/admin.py

```python
from django.contrib import admin
from orders.models import Order, OrderItem

class OrderItemInline(admin.TabularInline):
    model = OrderItem
    raw_id_fields = ['product']
    
@admin.register(Order)
class OrderAdmin(admin.ModelAdmin):
    list_display = ['id', 'first_name', 'last_name', 'email', 'address',
                    'postal_code', 'city', 'paid', 'created', 'updated']
    list_filter = ['paid', 'created', 'updated']
    inlines = [OrderItemInline]
```

### (3) ê³ ê° ì£¼ë¬¸ ìƒì„±í•˜ê¸°

- ìƒˆë¡œìš´ ì£¼ë¬¸ì˜ ìƒì„± ë‹¨ê³„
  - ì‚¬ìš©ìì—ê²Œ ë°ì´í„°ë¥¼ ì…ë ¥í•  ì£¼ë¬¸ í¼ ì œì‹œ
  - ì…ë ¥í•œ ë°ì´í„°ë¡œ ìƒˆë¡œìš´ Order ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  - ê° ì•„ì´í…œì— ëŒ€í•œ í•´ë‹¹ OrderItem ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  - ì¹´íŠ¸ì˜ ëª¨ë“  ë‚´ìš©ì„ ì§€ìš°ê³  ì‚¬ìš©ìë¥¼ ì„±ê³µ í˜ì´ì§€ë¡œ Redirection

- orders/forms.py
```python
from django import forms
from orders.models import Order

class OrderCreateForm(forms.ModelForm):
    class Meta:
        model = Order
        fields = ['first_name', 'last_name', 'email', 'address',
                  'postal_code', 'city']
```

- orders/views.py
  
```python
from django.shortcuts import render
from orders.models import OrderItem
from orders.forms import OrderCreateForm
from cart.cart import Cart

def order_create(request):
    cart = Cart(request)
    
    if request.method == "POST":
        form = OrderCreateForm(request.POST)
        if form.is_valid():
            order = form.save()
            for item in cart:
                OrderItem.objects.create(
                    order=order,
                    product=item['product'],
                    price=item['price'],
                    quantity=item['quantity']
                )
            cart.clear()
            return render(request, 'orders/order/created.html', {'order':order})
    else:
        form = OrderCreateForm()

    return render(request, 'orders/order/create.html', {'cart':cart, 'form':form})

```

- request.methodì— ë”°ë¥¸ ì‘ì—… ë‚´ìš©
  - GET ìš”ì²­
      1. OrderCreateForm í¼ì„ ì¸ìŠ¤í„´ìŠ¤í™”
      2. orders/order/create.html í…œí”Œë¦¿ì„ ë Œë”ë§
  - POST ìš”ì²­
      1. ì „ì†¡ëœ ë°ì´í„°ì˜ ìœ íš¨ì„± ê²€ì‚¬
      2. ë°ì´í„°ê°€ ìœ íš¨í•˜ë©´ order = form.save()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ìƒˆë¡œìš´ ì£¼ë¬¸ì„ ìƒì„±
      3. ì¹´íŠ¸ì˜ ì•„ì´í…œë“¤ì„ ë°˜ë³µí•´ì„œ ê° ì•„ì´í…œì— ëŒ€í•œ OrderItemì„ ìƒì„±
      4. ì¹´íŠ¸ì˜ ì½˜í…ì¸  ì‚­ì œ
      5. orders/order/created.html í…œí”Œë¦¿ì„ ë Œë”ë§
         
- orders/urls.py

```python
from django.urls import path
from . import views

app_name = 'orders'

urlpatterns = [
    path('create/', views.order_create, name='order_create'),
]
```

- orders/templages/orders/order/create.html

```python
{% extends "shop/base.html" %}

{% block title %}
    Checkout
{% endblock %}

{% block content %}
<h1>Checkout</h1>
<div class="order-info">
    <h3>Your Order</h3>
    <ul>
        {% for item in cart %}
            <li>
                {{ item.quantity }} x {{ item.product.name }}
                <span>${{ item.total_price }}</span>
            </li>
        {% endfor %}
    </ul>
    <p>
        TOtal: ${{ cart.get_total_price }}
    </p>
</div>
<form method="POST" class="order-form">
    {{ form.as_p }}
    <p><input type="submit" value="Place Order"></p>
    {% csrf_token %}
</form>
{% endblock %}
```

- orders/templages/orders/order/created.html

```python
{% extends "shop/base.html" %}

{% block title %}
Thank you
{% endblock %}

{% block content %}
<h1>Thank you</h1>
<p>Your order has been seccessfully completed. Your order number is 
    <strong>{{ order.id }}</strong>.</p>
{% endblock %}
```

- shop/templates/shop/base.html
<br><br/>

## 3. ì„±ëŠ¥ ê°œì„ 
### 3-1 ë¹„ë™ê¸° ì‘ì—…

- HTTP ìš”ì²­ì„ ë°›ìœ¼ë©´ ê°€ëŠ¥í•œ í•œ ë¹¨ë¦¬ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µì„ ë°˜í™˜í•´ì•¼ í•¨
  - ì£¼ë¡œ ë””ë²„ê·¸ ë„êµ¬ ë“±ì„ ì‚¬ìš©í•´ì„œ ìš”ì²­/ì‘ë‹µ ì£¼ê¸°ì˜ ì—¬ëŸ¬ ë‹¨ê³„ì— ê±¸ë¦¬ëŠ” ì‹œê°„ê³¼
    ìˆ˜í–‰ëœ SQL ì¿¼ë¦¬ì˜ ì‹¤í–‰ ì‹œê°„ì„ í™•ì¸í•˜ë©´ì„œ ì´ ì‘ë‹µì‹œê°„ì„ ë‹¨ì¶•í•˜ê¸° ìœ„í•´ ë…¸ë ¥í•¨
- ì‹¤í–‰ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì€ ì„œë²„ ì‘ë‹µ ì†ë„ë¥¼ ì‹¬ê°í•˜ê²Œ ì €í•˜ì‹œí‚¬ ìˆ˜ ìˆìŒ
  - ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ ì™„ë£Œí•˜ë©´ì„œ ì‚¬ìš©ìì—ê²Œ ë¹ ë¥¸ ì‘ë‹µì„ ë°˜í™˜í•˜ê¸° ìœ„í•œ ë°©ë²•ì˜ í•˜ë‚˜ë¡œ
    **ë¹„ë™ê¸° ì‹¤í–‰**ì„ í™œìš©í•¨

 ### (1) ë¹„ë™ê¸° ì‘ì—…ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸°
- ë™ê¸°(Synchronous)ì™€ ë¹„ë™ê¸°(Asynchronous)
    - ë™ê¸°
        - ì§ë ¬ì ìœ¼ë¡œ íƒœìŠ¤í¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹
        - ìš”ì²­ì„ ë³´ë‚¸ í›„ ì‘ë‹µì„ ë°›ì•„ì•¼ ë‹¤ìŒ ë™ì‘ì´ ì´ë£¨ì–´ì§€ëŠ” ë°©ì‹
        - ì–´ë– í•œ íƒœìŠ¤í¬ë¥¼ ì²˜ë¦¬í•  ë™ì•ˆ ë‚˜ë¨¸ì§€ íƒœìŠ¤í¬ëŠ” ëŒ€ê¸°
        - ì‹¤ì œë¡œ CPUê°€ ëŠë ¤ì§€ëŠ” ê²ƒì€ ì•„ë‹ˆì§€ë§Œ ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ íš¨ìœ¨ì´ ì €í•˜ë¨

    - ë¹„ë™ê¸°
        - ë³‘ë ¬ì ìœ¼ë¡œ íƒœìŠ¤í¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹
        - ìš”ì²­ì„ ë³´ë‚¸ í›„ ì‘ë‹µì˜ ìˆ˜ë½ ì—¬ë¶€ì™€ëŠ” ìƒê´€ì—†ì´ ë‹¤ìŒ íƒœìŠ¤í¬ê°€ ë™ì‘í•˜ëŠ” ë°©ì‹
        - A í…ŒìŠ¤í¬ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œê°„ ë™ì•ˆ B íƒœìŠ¤í¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
        - ë¹„ë™ê¸° ìš”ì²­ ì‹œ ì‘ë‹µ í›„ ì²˜ë¦¬í•  "ì½œë°± í•¨ìˆ˜"ë¥¼ í•¨ê»˜ ì•Œë ¤ì¤Œìœ¼ë¡œì¨ í•´ë‹¹ íƒœìŠ¤í¬ê°€ ì™„ë£Œë˜ì—ˆì„ ë•Œ "ì½œë°± í•¨ìˆ˜"ê°€ í˜¸ì¶œë˜ë„ë¡ í•¨
        - ê·¸ëŸ¬ë‚˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ ì²˜ë¦¬ ìˆœì„œë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ê°œì˜ ì½œë°± í•¨ìˆ˜ê°€ ì¤‘ì²©ë˜ì–´ ë³µì¡ë„ê°€ ë†’ì•„ì§€ëŠ” "ì½œë°± í—¬(Callback Hell)ì´ ë°œìƒí•˜ëŠ” ë‹¨ì ì´ ìˆìŒ
        - ì½œë°± í—¬ì€ ê°€ë…ì„±ì„ ë‚˜ì˜ê²Œ í•˜ë©° ì‹¤ìˆ˜ë¥¼ ìœ ë°œí•˜ëŠ” ì›ì¸ì´ ë¨

- ìš”ì²­/ì‘ë‹µ ì£¼ê¸°ì—ì„œ ì¼ë¶€ ì‘ì—…ì„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ ì‘ì—…ì„ ë¶„ì‚°ì‹œí‚¬ ìˆ˜ ìˆìŒ

- ë¹„ë™ê¸° ì‹¤í–‰ì€ íŠ¹íˆ ë°ì´í„° ì§‘ì•½ì , ë¦¬ì†ŒìŠ¤ ì§‘ì•½ì , ì‹œê°„ ì†Œëª¨ì ì¸ í”„ë¡œì„¸ìŠ¤ë‚˜ ì‹¤íŒ¨í•  ìˆ˜ ìˆëŠ” í”„ë¡œì„¸ìŠ¤ì— ì ì ˆí•˜ì§€ë§Œ ì¬ì‹œë„ ì •ì±…ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ

 ### (2) ì›Œì»¤, ë©”ì‹œì§€ í ë° ë©”ì‹œì§€ ë¸Œë¡œì»¤

 - **ì›Œì»¤**

   - ì›¹ ì„œë²„ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ë™ì•ˆ ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ë ¤ë©´ ì›Œì»¤(Worker)ë¼ëŠ” ì´ë¦„ì˜ ë˜ ë‹¤ë¥¸ ì‘ì—… ê¸°ë°˜ ì„œë²„ê°€ í•„ìš”í•¨
   - í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ ì›Œì»¤ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëŒë©´ì„œ ì‘ì—…ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ
   - ì›Œì»¤ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê³ , íŒŒì¼ì„ ì²˜ë¦¬í•˜ê³ , ì´ë©”ì¼ì„ ë³´ë‚´ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ
   - ì›Œì»¤ëŠ” í–¥í›„ ìˆ˜í–‰í•  ì‘ì—…ì„ ëŒ€ê¸°ì—´ì— ì¶”ê°€í•  ìˆ˜ ìˆìŒ
   - ë³„ë„ì˜ ì„œë²„ì¸ ì›Œì»¤ê°€ ì´ëŸ° ì‘ì—…ì„ ìˆ˜í–‰í•˜ë¯€ë¡œ ë©”ì¸ ì›¹ ì„œë²„ëŠ” HTTP ìš”ì²­ì„ ì—¬ìœ ìˆê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
<br><br/>  
- ë©”ì‹œì§€ íì™€ ë©”ì‹œì§€ ë¸Œë¡œì»¤
 
 **1. ë©”ì‹œì§€í**
    
   - ì›Œì»¤ì—ê²Œ ì–´ë–¤ ì‘ì—…ì„ ì‹¤í–‰í• ì§€ ì•Œë ¤ì£¼ê¸° ìœ„í•´ì„œëŠ” ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì•¼ í•¨
   - ì´ëŸ¬í•œ ë©”ì‹œì§€ëŠ” ì£¼ë¡œ ì„ ì…ì„ ì¶œ(FIFO) ë°©ì‹ì˜ ë°ì´í„° êµ¬ì¡°ì¸ ë©”ì‹œì§€ íì— ë©”ì‹œì§€ë¥¼ ë„£ì–´ì„œ í†µì‹ í•¨
   - ë©”ì‹œì§€ íë¥¼ ì´ìš©í•œ ì›Œì»¤ì™€ì˜ í†µì‹ ì€ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¼ëŠ” ëª¨ë“ˆì„ í†µí•´ ì´ë£¨ì–´ì§ 

 **2. ë©”ì‹œì§€ ë¸Œë¡œì»¤**

   - ë©”ì‹œì§• ë¯¸ë“¤ì›¨ì–´ ë˜ëŠ” ë©”ì‹œì§€ ì§€í–¥ ë¯¸ë“¤ì›¨ì–´ ì†”ë£¨ì…˜ ë‚´ì˜ ì†Œí”„íŠ¸ì›¨ì–´ ëª¨ë“ˆ
   - ë©”ì‹œì§€ íì— ë©”ì‹œì§€ í˜¹ì€ ì´ë²¤íŠ¸ë¥¼ ë„£ì–´ì£¼ê³  ì¤‘ê°œí•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ì£¼ì²´
<br><br/>
-------------------------------------------------------------------------------------------
- ì—¬ëŸ¬ ë¸Œë¡œì»¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ê° ë¸Œë¡œì»¤ëŠ” íì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¶€í„° ìˆœì„œëŒ€ë¡œ ê°€ì ¸ì˜´
- ë©”ì‹œì§€ íëŠ” ê° ë¸Œë¡œì»¤ê°€ í•œ ë²ˆì— í•˜ë‚˜ì˜ ì‘ì—…ë§Œ ê°€ì ¸ê°€ëŠ” ê²ƒì„ ë³´ì¥í•˜ë©° ì–´ë–¤ ì‘ì—…ë„ ì—¬ëŸ¬ ì›Œì»¤ì— ì˜í•´ ì²˜ë¦¬ë˜ì§€ ì•Šë„ë¡ í•¨
- ë©”ì‹œì§€ ë¸Œë¡œì»¤ëŠ” ë©”ì‹œì§€ë¥¼ ê³µì‹ ë©”ì‹œì§• í”„ë¡œí† ì½œë¡œ ë³€í™˜í•˜ê³  ì—¬ëŸ¬ ìˆ˜ì‹ ìì˜ ë©”ì‹œì§€ íë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ë¨
- ë©”ì‹œì§€ ë¸Œë¡œì»¤ëŠ” ë©”ì‹œì§€ì˜ ì•ˆì •ì ì¸ ì €ì¥ê³¼ ë©”ì‹œì§€ ì „ë‹¬ì„ ë³´ì¥í•¨
- ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë©”ì‹œì§€ íë¥¼ ë§Œë“¤ê³ , ë©”ì‹œì§€ë¥¼ ë¼ìš°íŒ…í•˜ê³ , ì‘ì—…ì ê°„ì— ë©”ì‹œì§€ë¥¼ ë°°í¬í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ
<br><br/>

### 3-2 Celery ë° RabbitMQì™€ í•¨ê»˜ ì¥ê³  ì‚¬ìš©í•˜ê¸°
### (1) Celery

- ë°©ëŒ€í•œ ì–‘ì˜ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë¶„ì‚° ì‘ì—… í
- Celeryë¥¼ ì‚¬ìš©í•˜ë©´ ë¹„ë™ê¸° ì‘ì—…ì„ ì‰½ê²Œ ìƒì„±í•˜ê³ , ê°€ëŠ¥í•œ í•œ ë¹¨ë¦¬ ì›Œì»¤ê°€ ì‹¤í–‰ë˜ë„ë¡ í•  ìˆ˜ ìˆìœ¼ë©°, íŠ¹ì • ì‹œê°ì— ì‹¤í–‰ë˜ë„ë¡ ì˜ˆì•½ì„ í•  ìˆ˜ ìˆìŒ
- ë©”ì‹œì§€ë¡œ í†µì‹ í•˜ë©° í´ë¼ì´ì–¸íŠ¸ì™€ ì›Œì»¤ ì‚¬ì´ë¥¼ ì¤‘ê°œí•˜ê¸° ìœ„í•´ ë©”ì‹œì§€ ë¸Œë¡œì»¤ê°€ í•„ìš”í•¨
   - Redisì™€ ê°™ì€ í‚¤/ê°’ ì €ì¥ì†Œ
   - RabbitMQì™€ ê°™ì€ ì‹¤ì œ ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë“±
     
### (2) RabbitMQ
- ê°€ì¥ ë„ë¦¬ ë°°í¬ëœ ë©”ì‹œì§€ ë¸Œë¡œì»¤
- ê³ ê¸‰ ë©”ì‹œì§€ í í”„ë¡œí† ì½œ(AMQP, Advanced Message Queue Protocal)ê³¼ ê°™ì€ ì—¬ëŸ¬ ë©”ì‹œì§• í”„ë¡œí† ì½œì„ ì§€ì›
- Celery ì‚¬ìš© ì‹œ ê°€ì¥ ê¶Œì¥ë˜ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤
- ê°€ë³ê³  ë°°í¬í•˜ê¸° ì‰¬ìš°ë©° í™•ì¥ì„±ê³¼ ê³ ê°€ìš©ì„±ì„ ìœ„í•´ êµ¬ì„±í•  ìˆ˜ ìˆìŒ

### (3) Celeryë¥¼ ì´ìš©í•œ ì‘ì—… ë‚´ìš©
- Celeryë¥¼ ì‚¬ìš©í•´ì„œ ë¹„ë™ê¸° ì‘ì—…ì„ ì¥ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì— íŒŒì´ì¬ í•¨ìˆ˜ë¡œ ì •ì˜
- ìƒˆë¡œìš´ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì™€ ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¥¼ ì²­ì·¨í•˜ì—¬ ìƒˆë¡œìš´ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” Celery ì›Œì»¤ ì‹¤í–‰

### (4) Celeryë¥¼ ìœ„í•œ í™˜ê²½ ì„¤ì •















